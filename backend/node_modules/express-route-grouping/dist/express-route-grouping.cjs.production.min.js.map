{"version":3,"file":"express-route-grouping.cjs.production.min.js","sources":["../src/resources.ts","../src/index.ts"],"sourcesContent":["const RESOURCES = {\n  index: { method: 'get', suffix: false },\n  find: { method: 'get', suffix: true },\n  create: { method: 'post', suffix: false },\n  update: { method: 'put', suffix: true },\n  patch: { method: 'patch', suffix: true },\n  delete: { method: 'delete', suffix: true },\n} as Record<string, Record<string, any>>;\n\nexport default RESOURCES;\n","import { IRouter as IExpressRouter, Router } from 'express';\nimport pluralize from 'pluralize';\nimport { RequestMethods, ResourceOptions, Resources } from './types';\nimport RESOURCES from './resources';\n\ntype GroupCallback = (router: IRouter) => void;\n\ntype IRouter = IExpressRouter & {\n  group: (path: string, fn: GroupCallback) => void;\n  resource: (options: ResourceOptions) => void;\n  export: () => IExpressRouter;\n};\n\nclass RouteGroup {\n  private head: string;\n  private router: IExpressRouter;\n  private proxyRouter?: IRouter;\n\n  constructor(path: string = '/', router: IExpressRouter = Router()) {\n    this.head = path;\n    this.router = router;\n  }\n\n  public group = (path: string = '', fn: GroupCallback): void => {\n    const newGroup = new RouteGroup(\n      this.head + this.sanitize(path),\n      this.router\n    );\n    this.proxyRouter = this.createProxy(this.router, newGroup);\n    fn(this.proxyRouter);\n  };\n\n  public resource = (options: ResourceOptions) => {\n    if (!options) {\n      throw new Error('Resource handlers are required!');\n    }\n\n    const { handlers = {}, beforeHandlers = [], afterHandlers = [] } = options;\n\n    Object.keys(RESOURCES).forEach((name: string) => {\n      const { method, suffix } = RESOURCES[name];\n      const requestRouter = this.router[method as RequestMethods];\n\n      const fullPath = this.to(suffix ? this.getPlaceholder() : '/');\n      const handler = handlers[name as Resources] as any;\n\n      if (handler) {\n        requestRouter.bind(this.router)(\n          fullPath,\n          ...beforeHandlers,\n          ...(Array.isArray(handler) ? handler : [handler]),\n          ...afterHandlers\n        );\n      }\n    });\n  };\n\n  public export = () => this.router;\n\n  public to = (suffix: string = '/'): string => {\n    return this.head + this.sanitize(suffix);\n  };\n\n  private sanitize(path: string): string {\n    if (path === '/') return '';\n\n    // remove slashes at start and end positions, if exists\n    // to sure there is no any slashes.\n    let newPath = path.replace(/^(\\/+)(.)/, '$2').replace(/(.)(\\/+)$/, '$1');\n\n    // add delimiter on the end\n    if (this.head !== '/') {\n      newPath = newPath.padStart(newPath.length + 1, '/');\n    }\n\n    return newPath;\n  }\n\n  private toCamelCase(str: string): string {\n    if (str === '') {\n      return str;\n    }\n\n    const word = str\n      .replace(/[^A-Za-z0-9]/g, ' ') // transfrom non-alphanumeric chars to space\n      .replace(/\\s+/g, ' ') // trim multiple space\n      .split(/[-_\\s]/)\n      .map(f => f[0].toLocaleUpperCase() + f.substr(1))\n      .join('');\n\n    return word[0].toLocaleLowerCase() + word.substr(1);\n  }\n\n  private callRouter(value: Function | RequestMethods) {\n    return typeof value === 'function'\n      ? (path: string, ...handlers: CallableFunction[]) => {\n          value.call(this.router, this.to(path), ...handlers);\n        }\n      : this.router[value];\n  }\n\n  private getPlaceholder() {\n    const namespace = this.head.split('/').pop() || '';\n    const prefix = pluralize.singular(this.toCamelCase(namespace));\n    return `:${prefix ? `${prefix}Id` : 'id'}`;\n  }\n\n  private createProxy(router: IExpressRouter, newGroup: RouteGroup) {\n    const self = newGroup as any;\n    const callRouter = this.callRouter.bind(newGroup);\n    const handler = {\n      get: function(_: any, prop: any) {\n        return self[prop]\n          ? Reflect.get(self, prop)\n          : callRouter(router[prop as RequestMethods]);\n      },\n    };\n\n    return new Proxy<IRouter>(this as any, handler);\n  }\n}\n\nexport default RouteGroup;\n"],"names":["RESOURCES","index","method","suffix","find","create","update","patch","path","router","Router","fn","newGroup","RouteGroup","_this","head","sanitize","proxyRouter","createProxy","options","Error","handlers","beforeHandlers","afterHandlers","Object","keys","forEach","name","requestRouter","fullPath","to","getPlaceholder","handler","bind","Array","isArray","newPath","replace","this","padStart","length","toCamelCase","str","word","split","map","f","toLocaleUpperCase","substr","join","toLocaleLowerCase","callRouter","value","call","_this2","namespace","pop","prefix","pluralize","singular","self","Proxy","get","_","prop","Reflect"],"mappings":"yKAAMA,EAAY,CAChBC,MAAO,CAAEC,OAAQ,MAAOC,QAAQ,GAChCC,KAAM,CAAEF,OAAQ,MAAOC,QAAQ,GAC/BE,OAAQ,CAAEH,OAAQ,OAAQC,QAAQ,GAClCG,OAAQ,CAAEJ,OAAQ,MAAOC,QAAQ,GACjCI,MAAO,CAAEL,OAAQ,QAASC,QAAQ,UAC1B,CAAED,OAAQ,SAAUC,QAAQ,0CCYxBK,EAAoBC,uBAApBD,IAAAA,EAAe,cAAKC,IAAAA,EAAyBC,uBAK1C,SAACF,EAAmBG,YAAnBH,IAAAA,EAAe,QACvBI,EAAW,IAAIC,EACnBC,EAAKC,KAAOD,EAAKE,SAASR,GAC1BM,EAAKL,QAEPK,EAAKG,YAAcH,EAAKI,YAAYJ,EAAKL,OAAQG,GACjDD,EAAGG,EAAKG,4BAGQ,SAACE,OACZA,QACG,IAAIC,MAAM,yCAGiDD,EAA3DE,SAAAA,aAAW,OAAgDF,EAA5CG,eAAAA,aAAiB,OAA2BH,EAAvBI,cAAAA,aAAgB,KAE5DC,OAAOC,KAAKzB,GAAW0B,SAAQ,SAACC,SACH3B,EAAU2B,GAC/BC,EAAgBd,EAAKL,SADnBP,QAGF2B,EAAWf,EAAKgB,KAHN3B,OAGkBW,EAAKiB,iBAAmB,KACpDC,EAAUX,EAASM,GAErBK,GACFJ,EAAcK,KAAKnB,EAAKL,sBACtBoB,UACGP,EACCY,MAAMC,QAAQH,GAAWA,EAAU,CAACA,GACrCT,oBAMK,kBAAMT,EAAKL,gBAEf,SAACN,mBAAAA,IAAAA,EAAiB,KACrBW,EAAKC,KAAOD,EAAKE,SAASb,SAzC5BY,KAAOP,OACPC,OAASA,6BA2CRO,SAAA,SAASR,MACF,MAATA,EAAc,MAAO,OAIrB4B,EAAU5B,EAAK6B,QAAQ,YAAa,MAAMA,QAAQ,YAAa,YAGjD,MAAdC,KAAKvB,OACPqB,EAAUA,EAAQG,SAASH,EAAQI,OAAS,EAAG,MAG1CJ,KAGDK,YAAA,SAAYC,MACN,KAARA,SACKA,MAGHC,EAAOD,EACVL,QAAQ,gBAAiB,KACzBA,QAAQ,OAAQ,KAChBO,MAAM,UACNC,KAAI,SAAAC,UAAKA,EAAE,GAAGC,oBAAsBD,EAAEE,OAAO,MAC7CC,KAAK,WAEDN,EAAK,GAAGO,oBAAsBP,EAAKK,OAAO,MAG3CG,WAAA,SAAWC,oBACO,mBAAVA,EACV,SAAC5C,8BAAiBa,mCAAAA,oBAChB+B,EAAMC,WAAND,GAAWE,EAAK7C,OAAQ6C,EAAKxB,GAAGtB,WAAUa,KAE5CiB,KAAK7B,OAAO2C,MAGVrB,eAAA,eACAwB,EAAYjB,KAAKvB,KAAK6B,MAAM,KAAKY,OAAS,GAC1CC,EAASC,EAAUC,SAASrB,KAAKG,YAAYc,eACxCE,EAAYA,OAAa,SAG9BvC,YAAA,SAAYT,EAAwBG,OACpCgD,EAAOhD,EACPuC,EAAab,KAAKa,WAAWlB,KAAKrB,UASjC,IAAIiD,MAAevB,KARV,CACdwB,IAAK,SAASC,EAAQC,UACbJ,EAAKI,GACRC,QAAQH,IAAIF,EAAMI,GAClBb,EAAW1C,EAAOuD"}